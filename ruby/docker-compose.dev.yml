services:
  devcontainer:
    container_name: ${APP_NAME}.devcontainer
    build:
      context: ./devcontainer
      dockerfile: Dockerfile
      # See https://docs.docker.com/compose/compose-file/build/#ssh
      ssh:
        - default
    working_dir: '/config/www'
    # See https://docs.docker.com/compose/environment-variables/envvars-precedence/
    environment:
      - TZ=${TIMEZONE:-Europe/Amsterdam}
    tty: true
    volumes:
      - '$HOME/.ssh:/config/.ssh'
      - '$HOME/.npmrc:/config/.npmrc'
      - '$HOME/.config/composer/auth.json:/config/.config/composer/auth.json'
      - '$HOME/Development/99linesofcode/${APP_NAME}:/config/www'

  ruby:
    build:
      context: ./dev
      dockerfile: Dockerfile
    command: "bundle exec rails s -p 3000 -b '0.0.0.0'"
    volumes:
      - '$HOME/Development/99linesofcode/${APP_NAME}:/config/www'

  phpmyadmin:
    image: phpmyadmin:latest
    container_name: ${APP_NAME}.phpmyadmin
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
      - MYSQL_USER=${DB_USERNAME}
      - MYSQL_PASSWORD=${DB_PASSWORD}
      - PMA_HOST=${APP_NAME}.mysql
      - PMA_PMADB=phpmyadmin
      - UPLOAD_LIMIT=512M
    restart: unless-stopped
    ports:
      - ${PHPMYADMIN_PORT:-8888}:80
    depends_on:
      - mysql
